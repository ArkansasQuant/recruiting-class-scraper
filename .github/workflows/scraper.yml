name: Run Recruiting Class Scraper

on:
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Test mode (true = 50 players, false = full scrape)'
        required: false
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'
      validation_sample:
        description: 'Number of players for accuracy validation'
        required: false
        default: '20'
        type: choice
        options:
          - '10'
          - '20'
          - '50'

jobs:
  scrape:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        playwright install chromium --with-deps
    
    - name: Run scraper
      run: python scraper.py
      env:
        # This now uses the input you select in the GitHub Actions UI
        TEST_MODE: ${{ github.event.inputs.test_mode }}
    
    # --- NEW DEBUG STEP ---
    - name: Debug - List all files
      if: always()
      run: |
        echo "=== Current Directory Contents ==="
        ls -la
        echo "=== Output Directory Contents ==="
        if [ -d "output" ]; then
          ls -R output
        else
          echo "Output directory does not exist!"
        fi
    # ----------------------

    - name: Validate output structure
      if: always()
      run: python validate_output.py
    
    - name: Validate accuracy
      if: always()
      run: python validate_accuracy.py ${{ github.event.inputs.validation_sample }}
    
    - name: Upload CSV output
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: CSV_Output
        path: output/*.csv
        retention-days: 90
    
    - name: Upload diagnostics
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: Diagnostics
        path: output/diagnostics/
        retention-days: 30
